<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Authorize Power-Up (Custom OAuth)</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const t = TrelloPowerUp.iframe();
      console.log("Launching full custom OAuth flow with Trello...");

      // 1) Build the Trello OAuth URL
      // Adjust scope, expiration, name, and callback_method if needed
      // 'return_url' must point to a page you control, e.g. callback.html
      const trelloAuthUrl =
        "https://trello.com/1/authorize?" +
        "expiration=never" +
        "&scope=read,write" +
        "&response_type=token" + 
        "&callback_method=fragment" +
        "&return_url=" + encodeURIComponent("https://birdieligos.github.io/trello-powerup-test/callback.html") +
        "&key=YOUR_API_KEY" +
        "&name=" + encodeURIComponent("Task Checklist Power-Up");

      // 2) Use t.authorize with the full URL. 
      // This opens the standard Trello auth page you showed in your screenshot.
      t.authorize(trelloAuthUrl, {
        height: 600,
        width: 800
      })
      .then(function(token) {
        console.log("Retrieved token:", token);
        // Store the token in member private storage
        return t.set('member', 'private', 'trello_token', token);
      })
      .then(function() {
        console.log("Token stored. Closing popup...");
        t.closePopup();
      })
      .catch(function(err) {
        console.error("Authorization error:", err);
      });
    });
  </script>
</body>
</html>
