<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Authorize Power-Up</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <h3>Authorizing...</h3>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var t = TrelloPowerUp.iframe();
      console.log("Authorization flow started...");

      t.authorize({
        type: 'popup',
        scope: { read: true, write: true, account: true },
        expiration: 'never',
        name: 'Task Checklist Power-Up'
      })
      .then(function(token) {
        console.log("Authorization successful. Retrieved token:", token);
        // Store the token in the user's private storage.
        return t.set('member', 'private', 'trello_token', token)
          .then(function() {
            console.log("Token stored in member private storage.");
          });
      })
      .then(function() {
        console.log("Closing authorization popup...");
        t.closePopup();
      })
      .catch(function(err) {
        console.error('Authorization error:', err);
      });
    });
  </script>
</body>
</html>
