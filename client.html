<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Create Task Checklist</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <script>
    const t = TrelloPowerUp.iframe();
    const API_KEY = '7443867af11d32c3e8f8152b114201fd';

    async function main() {
      // get current card ID
      const { id } = await t.card('id');
      // fetch token from private storage
      const token = await t.get('member','private','trello_token');
      if (!token) throw new Error('User not authorized');
      // create checklist
      await fetch(
        `https://api.trello.com/1/cards/${id}/checklists` +
        `?name=${encodeURIComponent('Task Checklist')}` +
        `&key=${API_KEY}&token=${token}`,
        { method: 'POST' }
      );
      // close popup
      t.closePopup();
    }

    main().catch(err => {
      console.error(err);
      t.closePopup();
    });
  </script>
</body>
</html>
