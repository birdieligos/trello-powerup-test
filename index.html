<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Trello Power-Up: Task Checklist & Mirroring</title>
  <!-- Load the Trello Power-Up client library -->
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Initialize your Power-Up using only allowed capabilities.
      // In this case, we use card-buttons and card-detail-badges.
      function getTaskChecklistId(t) {
        // Retrieve the stored checklist ID for this card.
        return t.get('card', 'shared', 'taskChecklistId');
      }

      // Return a badge for the card detail view if a checklist exists.
      function getTaskBadge(t) {
        return getTaskChecklistId(t).then(taskChecklistId => {
          if (taskChecklistId) {
            return [{
              title: 'Task Checklist',
              text: 'Edit',
              callback: function(t) {
                return t.popup({
                  title: 'Edit Task Checklist',
                  url: './client.html',
                  height: 250
                });
              }
            }];
          }
          return [];
        });
      }

      TrelloPowerUp.initialize({
        // Add a button on the card's front.
        'card-buttons': function(t, options) {
          return getTaskChecklistId(t).then(taskChecklistId => {
            let buttonText = taskChecklistId ? 'Edit Task Checklist' : 'Create Task Checklist';
            return [{
              text: buttonText,
              callback: function(t, options) {
                return t.popup({
                  title: buttonText,
                  url: './client.html',
                  height: 250
                });
              }
            }];
          });
        },
        // Optionally, add a detail badge.
        'card-detail-badges': function(t, options) {
          return getTaskBadge(t);
        }
      });
    });
  </script>
</body>
</html>
