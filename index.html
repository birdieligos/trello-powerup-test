<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Trello Power-Up: Task Checklist & Authorization</title>
  <!-- Load the Trello Power-Up client library -->
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      TrelloPowerUp.initialize({

        // 1. Authorization check: see if a token is already stored
        'authorization-status': function(t, options) {
          return t.get('member', 'private', 'trello_token')
            .then(function(token) {
              // Return true if a token is found, else false
              return { authorized: !!token };
            });
        },

        // 2. Show authorization popup if user is not authorized
        'show-authorization': function(t, options) {
          return t.popup({
            title: 'Authorize Power-Up',
            url: './authorize.html',
            height: 150
          });
        },

        // 3. Card buttons: ALWAYS show "Create Task Checklist"
        //    (Removed logic that checks if a checklist ID exists)
        'card-buttons': function(t, options) {
          return [{
            text: 'Create Task Checklist',
            callback: function(t, options) {
              return t.popup({
                title: 'Create Task Checklist',
                url: './client.html',
                height: 250
              });
            }
          }];
        },

        // 4. REMOVE the card-detail-badges entirely. 
        //    This removes the "Task Checklist" badge on the back of the card.
        // 'card-detail-badges': function(t, options) {
        //   return t.get('card', 'shared', 'taskChecklistId')
        //     .then(function(taskChecklistId) {
        //       if (taskChecklistId) {
        //         return [{
        //           title: 'Task Checklist',
        //           text: 'Edit',
        //           callback: function(t) {
        //             return t.popup({
        //               title: 'Edit Task Checklist',
        //               url: './client.html',
        //               height: 250
        //             });
        //           }
        //         }];
        //       }
        //       return [];
        //     });
        // },

        // (Optional) If you want to keep onRender:
        'onRender': function(t) {
          return t.render();
        }
      });
    });
  </script>
</body>
</html>
