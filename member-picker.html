<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Assign Member</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <style>/* styling omitted for brevity */</style>
</head>
<body style="font-family:sans-serif;padding:10px">
  <ul id="member-list"></ul>
  <button id="save-selection" disabled style="margin-top: 10px;">Save</button>

  <script>
    const t = TrelloPowerUp.iframe();
    const list = document.getElementById('member-list');
    const saveBtn = document.getElementById('save-selection');
    const taskId = t.arg('taskId');
    let selectedMember = null;

    async function loadMembers() {
      const board = await t.board('id');
      const token = await t.get('member', 'private', 'trello_token');
      const res = await fetch(`https://api.trello.com/1/boards/${board.id}/members?key=7443867af11d32c3e8f8152b114201fd&token=${token}`);
      const members = await res.json();

      members.sort((a, b) => a.fullName.localeCompare(b.fullName));
      members.forEach(m => {
        const li = document.createElement('li');
        li.className = 'member-item';
        li.textContent = m.fullName;

        li.addEventListener('click', () => {
          document.querySelectorAll('.member-item').forEach(el => el.classList.remove('selected'));
          li.classList.add('selected');
          selectedMember = m.fullName;
          saveBtn.disabled = false;
        });

        list.appendChild(li);
      });
    }

    saveBtn.addEventListener('click', () => {
      if (selectedMember) {
        console.log(`[Member Picker] Save clicked: ${selectedMember}`);
        t.closePopup({ taskId, memberName: selectedMember });
      }
    });

    loadMembers();
  </script>
</body>
</html>
